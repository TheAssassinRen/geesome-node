<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress {{ version }}">
    <style>
        #app {
            display: none;
        }
    </style>
    <!--vuepress-ssr-head-->
    <!--vuepress-ssr-resources-->
    <!--vuepress-ssr-styles-->
</head>
<body>
<div id="app"><!--vuepress-ssr-app--></div>
<!--vuepress-ssr-scripts-->

<script>
    docReady(function() {
        const ipfsBaseUri = getIpfsBaseUri();

        if (!ipfsBaseUri) {
            return;
        }

        document.querySelectorAll('a').forEach((el) => {
            let href = el.getAttribute("href");
            if (href.startsWith('/')) {
                href = ipfsBaseUri + href;
                el.setAttribute("href", href);
            }
        });
    });

    function isIpfsHash(str) {
        return (str.startsWith('Qm') || (str.startsWith('baf') && str.length === 59)) && /^\w+$/.test(str);
    }

    function getIpfsBaseUri() {
        let pathname = document.location.pathname;
        if (pathname.endsWith('/')) {
            pathname = pathname.slice(0, -1);
        }
        const splitPathname = pathname.split('/');
        let ipfsHashIndex = -1;
        splitPathname.some((chunk, index) => {
            console.log('isIpfsHash', chunk, isIpfsHash(chunk))
            if (isIpfsHash(chunk)) {
                ipfsHashIndex = index;
            }
        });

        if (ipfsHashIndex === -1) {
            return '';
        }

        return splitPathname.slice(0, ipfsHashIndex + 1).join('/');
    }

    function docReady(fn) {
        if (document.readyState === "complete" || document.readyState === "interactive") {
            setTimeout(fn, 1);
        } else {
            document.addEventListener("DOMContentLoaded", fn);
        }
    }
</script>
</body>
</html>